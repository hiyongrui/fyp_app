<ion-header>

  <ion-toolbar color="primary" *ngIf="checked.length == 0">

    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/templates/new" (click)="goBackToTemplate()"></ion-back-button>
    </ion-buttons>

    <ion-title style="position:inherit;">
      {{planName}}
    </ion-title>
    <ion-buttons slot="end" (click)="PlanDetails()"  (click)="getTime()"><ion-button>SAVE</ion-button></ion-buttons>
      </ion-toolbar>

    <ion-buttons slot="end" (click)="PlanDetails()"><ion-button><ion-icon name="save"></ion-icon></ion-button></ion-buttons>

  </ion-toolbar>

  <ion-toolbar color="greenCard" *ngIf="checked.length > 0">
    <ion-buttons slot="start">
      <ion-back-button (click)="clearArray()"></ion-back-button>
      <span> {{checked.length}} </span>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-icon name="trash" style="font-size: 24px; margin-right:14px;" (click)="deleteArray()"></ion-icon>
    </ion-buttons>
  </ion-toolbar>

</ion-header>

<ion-content>
  <ion-list lines="none">
    <ion-card class="welcome-card">
      <ion-card-header color="tertiary">
        <ion-card-title>Plan Details</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <div>
          <table id="tblOne" style="width:50%; float:left">
            <tr>
              <td>Name:</td>
              <ion-input type="text" [(ngModel)]="pName"></ion-input>
            </tr>
            <p></p>
            <tr>
              <td>TCS Name:</td>
              <ion-input type="text" [(ngModel)]="tcsName"></ion-input>
            </tr>
          </table>
          <table id="tblTwo" style="width:50%; float:left">
            <tr>
              <td>NRIC:</td>
              <ion-input type="text" [(ngModel)]="pNric"></ion-input>
            </tr>
            <tr>
              <td>TCS Contact:</td>
              <ion-input type="text" [(ngModel)]="tcsContact"></ion-input>
            </tr>
          </table>
        </div>
      </ion-card-content>

    </ion-card>
  </ion-list>
  <ion-list lines="none">
    <ion-card class="welcome-card">
      <ion-card-header color="tertiary">
        <ion-card-title>Appointment (OPTIONAL)</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <div>
          <table id="tblOne" style="width:50%; float:left">
            <tr>
              <td>Clinic Name:</td>
              <p></p>
              <ion-input style="width: 250%"></ion-input>
            </tr>
          </table>
          <ion-item lines="full">
            <ion-label>Date:</ion-label>
            <ion-datetime placeholder="eg. 29 June 2019" [(ngModel)]="datedmy" (ionChange)="dateChanged($event)" display-format="DD/MMM/YYYY"></ion-datetime>
          </ion-item>
          <ion-item lines="full">
            <ion-label>Time:&nbsp;&nbsp; </ion-label>
            <ion-datetime placeholder="eg. 13:30 am/pm" displayFormat="h:mm A" ></ion-datetime>
          </ion-item>
        </div>
      </ion-card-content>
    </ion-card>
  </ion-list>





  <style>
    .imgCircle {
      float: left;
      border-radius: 50%;
      width: 50%;
      height: 100%;
      padding: 4%;
      /* background-color:#000000 !important; */
      /* border: 1px solid black;  */
    }

    .imgCircleText {
      /* height:100%; */
      /* margin:16px; */
      white-space: normal;
      text-align: left;
      margin-top: 12%;
      /*FIXME: https://ionicframework.com/docs/v3/theming/css-utilities/ */
    }

    /* 
ion-content{
  --ion-background-color:grey;
} */

    ion-card {
      border-radius: 16px;
      background-color: white;
      color: black;
      /* text */
    }

    ion-grid {
      background-color: #d3d3d3;
    }

    .btnAdd {
      margin-top: 18px !important;
    }

    .blur {
      filter: blur(15px);
      -webkit-filter: blur(15px);
      opacity: 1;
      background-color: #FFF;
      transition: -webkit-filter 200ms linear;
      height: 100%;
      width: 100%;
      position: absolute;
    }

    .blurTitle {

      filter: blur(15px);
      -webkit-filter: blur(15px);
      /* transition: -webkit-filter 200ms linear; */
    }

    /* .highlight{
  background-color: #1ebea5;
} */

    ion-content {
      --padding-start: 4px;
      --padding-end: 4px;
    }

    /* ion-grid{
  width: 100vw;
  margin-left: calc(-50vw + 50%);
} */
    .gridReplace {
      background-color: #d3d3d3;
      padding-top: 6%;
      padding-bottom: 3%;
    }

    ion-card-title {
      color: white;
      font-weight: bold;
      font-size: 1.1em;
      padding: 0;
      margin: 0 4px;
    }

    ion-textarea {
      margin: 0;
    }

    .yellowItem {
      --border-width: 0px;
      --inner-padding-end: 0;
      --padding-start: 0;
    }
  </style>

  <!-- Test my data yong rui -->
  <ion-card *ngFor="let globalItem of frontViewData">
    <ion-card-header [color]="globalItem.colorCard">
      <ion-card-title>
        {{globalItem.textCard}}
      </ion-card-title>

      <ion-content>
        <ion-fab vertical="top" horizontal="end" edge slot="fixed">
          <!-- <ion-fab-button size="small" (click)="addNewCriticalArray('Critical')" class="btnAdd" color="redCard"> -->
          <ion-fab-button size="small" class="btnAdd" (click)="globalItem.toggle=!globalItem.toggle"
            [disabled]="checked.length > 0">
            <ion-icon name="{{!globalItem.toggle ? 'md-add' : 'md-close'}}"></ion-icon>
          </ion-fab-button>
        </ion-fab>
      </ion-content>
    </ion-card-header>



    <div class="gridReplace">
      <!--https://forum.ionicframework.com/t/fab-button-backdrop/80019-->


      <ion-row *ngFor="let item of getArray(globalItem.id); let i = index;" style="border-bottom: 2px solid #A9A9A9"
        [ngClass]="{'blur': globalItem.toggle}">

        <!-- first column aka symptom -->
        <ion-col [size]="checked.length > 0 ? 5.25 : 6"
          [ngClass]="{'highlight': item.combined[0]?.whatsapp && checked.length > 0}"
          (press)="pressEvent('Symptom', item, globalItem.id);"
          (click)="checked.length > 0 && clickEvent('Symptom', item, globalItem.id)">
          <ion-card (click)="checked.length == 0 && presentActionSheet('Symptom', item, globalItem.id)"
            [ngClass]="{'highlight' : item.combined[0]?.whatsapp && checked.length > 0}">
            <img class="imgCircle" [src]="item.symptom.img" />
            <!-- https://stackoverflow.com/questions/45263542/ngmodel-value-in-img-src-ionic-3 -->
            <p class="imgCircleText"> {{item.symptom.text}} </p>
          </ion-card>
          <ion-card>
            <ion-item no-padding class="yellowItem">
              <ion-textarea rows="4" placeholder="Describe the symptom in more details."
                [readonly]="item.combined[0]?.whatsapp" [(ngModel)]="item.symptom.description"
                [ngClass]="{'highlight': item.combined[0]?.whatsapp && checked.length > 0}"></ion-textarea>
            </ion-item>
          </ion-card>
        </ion-col>

        <!-- for each second column aka action -->
        <ng-container *ngFor="let x of item.combined; let actIndex = index;">

          <ion-col [size]="checked.length > 0 ? 5.25 : 6" [ngClass]="{'highlight': x.whatsapp && checked.length > 0}"
            (press)="pressEvent('Action', x, globalItem.id)"
            (click)="checked.length > 0 && clickEvent('Action', x, globalItem.id)" *ngIf="actIndex != 0"></ion-col>

          <ion-col [size]="checked.length > 0 ? 5.25 : 6" [ngClass]="{'highlight': x.whatsapp && checked.length > 0}"
            (press)="actIndex == 0 ? pressEvent('Symptom', item, globalItem.id) : pressEvent('Action', x, globalItem.id);"
            (click)="checked.length > 0 && clickEvent('Action', x, globalItem.id)">

            <ion-card (click)="checked.length == 0 && presentActionSheet('Action', x)"
              [ngClass]="{'highlight': x.whatsapp && checked.length > 0}">
              <img class="imgCircle" [src]="x.img" />
              <p class="imgCircleText"> {{x.text}}</p>
            </ion-card>

            <ion-card>
              <ion-item no-padding class="yellowItem">
                <ion-textarea rows="4" placeholder="Describe the required action in your own words."
                  [readonly]="x.whatsapp" [(ngModel)]="x.description"
                  [ngClass]="{'highlight': x.whatsapp && checked.length > 0}"></ion-textarea>
              </ion-item>
            </ion-card>


          </ion-col>

          <ion-col size="1.5" *ngIf="checked.length > 0" [ngClass]="{'highlight': x.whatsapp}"
            (click)="clickEvent('Action', x, globalItem.id)">
            <ion-checkbox [checked]="x.whatsapp" mode="ios" color="success"></ion-checkbox>
          </ion-col>

        </ng-container>

      </ion-row>



      <ion-row style="height:150px;" [ngClass]="{'blur': globalItem.toggle}" *ngIf="!checkType(globalItem.id)">
      </ion-row>


      <ng-container *ngIf="globalItem.toggle">
        <!--https://stackoverflow.com/questions/28975673/how-to-blurcss-div-without-blur-child-element/29249483-->
        <ion-row (click)="globalItem.toggle=!globalItem.toggle; addNewCriticalArray(globalItem.type, globalItem.id)">
          <ion-col size="4">
            <ion-fab-button [color]="globalItem.colorBtn" style="float:right">
              <ion-icon name="add"></ion-icon>
            </ion-fab-button>
          </ion-col>
          <ion-col size="8">
            <ion-label class="addLabel"> Add symptom</ion-label>
            <br>
            <ion-label class="addLabelTwo"> and action </ion-label>
          </ion-col>
        </ion-row>

        <ion-row *ngIf="checkType(globalItem.id)" (click)="globalItem.toggle=!globalItem.toggle; popUp(globalItem.id);">
          <ion-col size="4">
            <ion-fab-button [color]="globalItem.colorBtn" style="float:right">
              <ion-icon name="add"></ion-icon>
            </ion-fab-button>
          </ion-col>
          <ion-col size="8">
            <ion-label class="addLabel"> Add action</ion-label>
          </ion-col>
        </ion-row>
      </ng-container>
    </div>

  </ion-card>

</ion-content>